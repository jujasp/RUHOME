<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>R U Home?</title>
        <meta name="description" content="R U Home?">
        <script src="https://aframe.io/releases/0.7.1/aframe.min.js"></script>
        <script src="https://cdn.rawgit.com/zcanter/aframe-gradient-sky/master/dist/gradientsky.min.js"></script>
        <script src="https://unpkg.com/aframe-event-set-component@^4.0.0/dist/aframe-event-set-component.min.js"></script>
        <script src="https://unpkg.com/aframe-animation-component@4.0.0-beta8/dist/aframe-animation-component.min.js"></script>
        <script src="https://unpkg.com/aframe-firebase-component@^4.0.0/dist/aframe-firebase-component.min.js"></script>
        <script src="https://unpkg.com/aframe-randomizer-components@^3.0.1/dist/aframe-randomizer-components.min.js"></script>
        <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v3.13.1/dist/aframe-extras.min.js"></script>
        <script src="/components/components.js">
        //fog="type: linear; color: #356569; far: 50; near: 0"</script>
    </head>
    <script>
        AFRAME.registerComponent('cursor-listener', {
    init: function () {
        this.el.addEventListener('click', function (evt) {
        console.log('CURSOR LISTENER: ', evt.detail.intersection.point)
    })}
})
AFRAME.registerComponent("move",{
    schema : {
      target : { type : "selector"}
    },
    init: function() {
        this.el.addEventListener("click", () => {
            this.data.target.setAttribute("position",  Math.floor(Math.random() * 5) + " " + Math.floor(Math.random() * 5) + " " + Math.floor(Math.random() * 5));
        })
    }
})

AFRAME.registerComponent("respawn",{
    schema : {},
    tick: function () {
        var cameraEl = this.el.sceneEl.camera.el;
        cameraEl.getAttribute('position');
        cameraEl.getAttribute('rotation');
        if(cameraEl.getAttribute('position').y <= -10) {
            cameraEl.setAttribute('position', "0 1.6 0")
        }       
    },
})

AFRAME.registerComponent("foundhome",{
    schema: {},
    init: function () {
        var playerEl = document.querySelector('#camera')
        playerEl.addEventListener('collide', function (e) {
            let collidedObj = e.detail.body.el
            if(collidedObj.id === "yard" || collidedObj.id=== "home") {
                let youWon = document.createElement("a-entity")
                    youWon.setAttribute("text", "value: U R HOME;color:white;width: 300;opacity:0.80")
                    youWon.setAttribute("position", "0 70 -100")
                    document.querySelector('a-scene').appendChild(youWon)  
            }
        })     
    }
})

AFRAME.registerComponent("randommovement",{
    schema: {},
    update: function() {
        this.el.addEventListener("mouseenter", () => {
        let originalPosition = this.el.getAttribute("position")
        let randomAdditions = Math.floor(Math.random()*5) + 1
        randomAdditions *= Math.floor(Math.random()*2) == 1 ? 1 : -1
        let randomNewPosition = {
            x: originalPosition.x + randomAdditions,
            y: originalPosition.y + randomAdditions,
            z: originalPosition.z + randomAdditions
        }

        let newPositionString = randomNewPosition.x + " " + randomNewPosition.y + " " + randomNewPosition.z

        let animation = document.createElement("a-animation")
        animation.setAttribute("attribute", "position")
        animation.setAttribute("direction", "alternate")
        animation.setAttribute("repeat", "indefinite")
        animation.setAttribute("easing", "ease")
        animation.setAttribute("to", newPositionString)
        this.el.appendChild(animation)  
        })
    },
})
AFRAME.registerComponent("collision-register", {
    init: function(){
        var playerEl = document.querySelector('#camera');
        playerEl.addEventListener('collide', function (e) {
        console.log(e.detail.contact.ni);
        })
    }
})

AFRAME.registerComponent("collisionfall", {
    init: function(){
        var playerEl = document.querySelector('#camera');
        playerEl.addEventListener('collide', function (e) {
        
        let collidedObj = e.detail.body.el

        let originalPosition = e.detail.body.el.getAttribute("position")
        let randomNewPosition = {
            x: originalPosition.x,
            y: originalPosition.y,
            z: originalPosition.z
        }

        let newPositionString = randomNewPosition.x + " " + -10 + " " + randomNewPosition.z

        let dropAni = document.createElement("a-animation")
        dropAni.setAttribute("attribute", "position")
        dropAni.setAttribute("direction", "normal")
        dropAni.setAttribute("repeat", "0")
        dropAni.setAttribute("easing", "ease")
        dropAni.setAttribute("to", newPositionString)

        let renewPosStr = randomNewPosition.x + " " + originalPosition.y + " " + randomNewPosition.z

        let renewPos = document.createElement("a-animation")
        renewPos.setAttribute("attribute", "position")
        renewPos.setAttribute("direction", "normal")
        renewPos.setAttribute("repeat", "0")
        renewPos.setAttribute("easing", "ease")
        renewPos.setAttribute("to", renewPosStr)
        
        if(e.detail.contact.ni.y === -1 && (collidedObj.id !== "ground" && collidedObj.id !== "home" && collidedObj.id !== "yard")) {
            setTimeout(function() {
                collidedObj.appendChild(dropAni)
            }, 3000)
        }

        setTimeout(function() {
                collidedObj.appendChild(renewPos)
            }, 10000)


         //   fog="type: linear; color: #e63462; far: 30; near: 0"
        //   e.detail.target.el;  // Original entity (playerEl).
        //   e.detail.body.el;    // Other entity, which playerEl touched.
        //   e.detail.contact;    // Stats about the collision (CANNON.ContactEquation).
        //   e.detail.contact.ni; // Normal (direction) of the collision (CANNON.Vec3).
        })
    }
})
    </script>
    <body>
<!-- SCENE -->
        <a-scene 
            physics
            class="fullscreen" 
            canvas="" 
            inspector="" 
            keyboard-shortcuts="" 
            screenshot="" 
            vr-mode-ui="" 
            auto-enter-vr="">
<!-- ASSETS -->
        <a-assets>
            <a-asset-item id="home-obj" src="./models/home/3dhome.obj"></a-asset-item>
            <a-mixin id="avatar"
            geometry="primitive: box; depth: 0.3; height: 0.3; width: 0.3"
            material="color: #222"></a-mixin>
        </a-assets>
<!-- USER-->
        <a-entity
            id="camera"
            camera="userHeight: 1.6"
            universal-controls
            kinematic-body
            geometry="primitive: sphere; radius: 0.005"
            jump-ability="maxJumps:3;"
            cursor-listener
            collision-register
            collisionfall
            respawn
            foundhome
            mixin="avatar-head">
            <a-cursor position="0 0 0"
            geometry="primitive: sphere; radius: 0.005"
            material="color: #FFFFFF; shader: flat; opacity: 0.5">
            </a-cursor>
        </a-entity>
<!-- LIGHTS -->
        <a-light type="ambient" color="#102550" intensity="3"></a-light>
        <a-light type="ambient" color="white" intensity=".2"></a-light>
        <a-light type="directional" color="white" intensity=".1" position="20 1 1"></a-light>
<!-- GROUND -->
        <a-grid
            id="ground" 
            static-body
            scale="0.5 0.5 0.5"
            material="shader:flat; flatShading:true; roughness: 1; metalness:0; opacity:0.8;fog:false;color:#102550;src:""">
        </a-grid>

<!-- SKY -->
        <a-gradient-sky material="shader: gradient; 
                                topColor:16 37 80; 
                                bottomColor:53 101 105;">
        </a-gradient-sky>

        <a-entity id="R U HOME" text="value: R U HOME?;color:white;width: 300;opacity:0.50" position="0 80 -100"></a-entity>
        <a-entity id="R U HOME" text="value: your home is 50 meters in the sky.
            you should try to get home.;color:white;width: 200;opacity:0.20" position="0 100 -150"></a-entity>

        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 4 -10; max:13 12 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 4 -10; max:13 12 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 6 -10; max:13 10 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 4 -10; max:13 10 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 4 -10; max:13 10 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 6 -10; max:13 12 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 4 -10; max:13 10 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 4 -10; max:13 12 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 4 -10; max:13 10 10" static-body scale="2 0.3 1.5"></a-entity>

        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 8 -10; max:13 14 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 8 -10; max:13 14 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 8 -10; max:13 14 10" static-body scale="2 0.3 1.5"></a-entity>
        
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 15 -10; max:10 35 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 15 -10; max:10 35 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 15 -10; max:10 35 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 15 -10; max:10 35 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 15 -10; max:10 35 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 15 -10; max:10 35 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 15 -10; max:10 35 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 15 -10; max:10 35 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 15 -10; max:10 35 10" static-body scale="2 0.3 1.5"></a-entity>
    
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 15 -10; max:10 35 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 15 -10; max:10 35 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 15 -10; max:10 35 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 15 -10; max:10 35 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 15 -10; max:10 35 10" static-body scale="2 0.3 1.5"></a-entity>
        
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 35 -10; max:10 45 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 35 -10; max:10 45 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 35 -10; max:10 45 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 35 -10; max:10 45 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 35 -10; max:10 45 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 35 -10; max:10 45 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 35 -10; max:10 45 10" static-body scale="2 0.3 1.5"></a-entity>

        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 35 -10; max:10 45 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 35 -10; max:10 45 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 35 -10; max:10 45 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 35 -10; max:10 45 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 35 -10; max:10 45 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 35 -10; max:10 45 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 35 -10; max:10 45 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 35 -10; max:10 45 10" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-10 35 -10; max:10 45 10" static-body scale="2 0.3 1.5"></a-entity>

        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-16 40 -10; max:16 49 16" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-16 40 -10; max:16 49 16" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-16 40 -10; max:16 49 16" static-body scale="2 0.3 1.5"></a-entity>
        <a-entity geometry="primitive: box; radius: 0.3" random-position="min:-16 40 -10; max:16 49 16" static-body scale="2 0.3 1.5"></a-entity>
<!-- 
        <a-entity geometry="primitive: dodecahedron; radius: 0.3" random-position="min:-20 5 10; max:20 40 -20" static-body material="wireframe:true" random-scale="min: 2 2 2; max: 5 5 5" randommovement></a-entity>
        <a-entity geometry="primitive: dodecahedron; radius: 0.3" random-position="min:-20 5 10; max:20 10 -20" static-body material="wireframe:true" random-scale="min: 2 2 2; max: 5 5 5" randommovement></a-entity>
        <a-entity geometry="primitive: dodecahedron; radius: 0.3" random-position="min:-20 5 10; max:20 10 -20" static-body material="wireframe:true" random-scale="min: 2 2 2; max: 5 5 5" randommovement></a-entity>
        <a-entity geometry="primitive: dodecahedron; radius: 0.3" random-position="min:-20 5 10; max:20 10 -20" static-body material="wireframe:true" random-scale="min: 2 2 2; max: 5 5 5" randommovement></a-entity>
        <a-entity geometry="primitive: dodecahedron; radius: 0.3" random-position="min:-20 5 10; max:20 10 -20" static-body material="wireframe:true" random-scale="min: 2 2 2; max: 5 5 5" randommovement></a-entity>
        <a-entity geometry="primitive: dodecahedron; radius: 0.3" random-position="min:-20 5 10; max:20 10 -20" static-body material="wireframe:true" random-scale="min: 2 2 2; max: 5 5 5" randommovement></a-entity>
        <a-entity geometry="primitive: dodecahedron; radius: 0.3" random-position="min:-20 5 10; max:20 10 -20" static-body material="wireframe:true" random-scale="min: 2 2 2; max: 5 5 5" randommovement></a-entity>
        <a-entity geometry="primitive: dodecahedron; radius: 0.3" random-position="min:-20 5 10; max:20 10 -20" static-body material="wireframe:true" random-scale="min: 2 2 2; max: 5 5 5" randommovement></a-entity>
        <a-entity geometry="primitive: dodecahedron; radius: 0.3" random-position="min:-20 5 10; max:20 10 -20" static-body material="wireframe:true" random-scale="min: 2 2 2; max: 5 5 5" randommovement></a-entity>
        <a-entity geometry="primitive: dodecahedron; radius: 0.3" random-position="min:-20 5 10; max:20 10 -20" static-body material="wireframe:true" random-scale="min: 2 2 2; max: 5 5 5" randommovement></a-entity>
        <a-entity geometry="primitive: dodecahedron; radius: 0.3" random-position="min:-20 5 10; max:20 10 -20" static-body material="wireframe:true" random-scale="min: 2 2 2; max: 5 5 5" randommovement></a-entity>
        <a-entity geometry="primitive: dodecahedron; radius: 0.3" random-position="min:-20 5 10; max:20 10 -20" static-body material="wireframe:true" randommovement></a-entity> -->

        <a-entity geometry="primitive: dodecahedron; radius: 0.3" random-position="min:-20 5 10; max:20 10 -20" static-body material="wireframe:true" randommovement scale="5 5 5"></a-entity>
        <a-entity geometry="primitive: dodecahedron; radius: 0.3" random-position="min:-20 5 10; max:20 10 -20" static-body material="wireframe:true" randommovement scale="5 5 5"></a-entity>
        <a-entity geometry="primitive: dodecahedron; radius: 0.3" random-position="min:-20 5 10; max:20 10 -20" static-body material="wireframe:true" randommovement scale="5 5 5"></a-entity>
        <a-entity geometry="primitive: dodecahedron; radius: 0.3" random-position="min:-20 5 10; max:20 10 -20" static-body material="wireframe:true" randommovement scale="5 5 5"></a-entity>
        <a-entity geometry="primitive: dodecahedron; radius: 0.3" random-position="min:-20 5 10; max:20 10 -20" static-body material="wireframe:true" randommovement scale="5 5 5"></a-entity>
        <a-entity geometry="primitive: dodecahedron; radius: 0.3" random-position="min:-20 5 10; max:20 10 -20" static-body material="wireframe:true" randommovement scale="5 5 5"></a-entity>

        <a-entity geometry="primitive: torusKnot;" position="0 60 -130" static-body material="wireframe:true" scale="5 5 5">
            <a-animation attribute="rotation" from="0 0 0" to="90 180 90" repeat="indefinite" duration="15000" direction="alternate" ease="bounce"></a-animation>
        </a-entity>
    
        <a-sphere id="platform1"
        width="4" height="0.25" depth="4"
        position="7 3 -15"
        material="wireframe:true;"
        random-position="min:-20 5 10; max:20 10 -20"
        velocity="0 0 0"
        toggle-velocity="axis: y; min: -5; max: 5;"
        static-body>
        </a-sphere>
        <a-sphere
        width="4" height="0.25" depth="4"
        position="7 3 -15"
        material="wireframe:true;"
        random-position="min:-20 5 10; max:20 10 -20"
        velocity="0 0 0"
        toggle-velocity="axis: y; min: -5; max: 5;"
        dynamic-body>
        </a-sphere>
        <a-sphere
        width="4" height="0.25" depth="4"
        material="wireframe:true;"
        random-position="min:-20 5 20; max:20 40 -20"
        dynamic-body>
        </a-sphere>

        <a-entity id="home" obj-model="obj:#home-obj;" scale="0.017 0.017 0.017" position="0.871 50.117 0.658" material="color:red;" static-body></a-entity>
        <a-entity id="yard" geometry="primitive: box; radius: 0.3" position="0 50 0" static-body scale="7 0.3 7"></a-entity>
<!-- LIGHTBULB -->
        <a-entity obj-model="obj:./models/lightbulb/bulb.obj" optacity="1" scale="1.58 1.58 1.58" position="0 0 0" id="bulb" lightsout="target:#directional"></a-entity>
    </a-scene>
  </body>
</html>
